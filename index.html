<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Tabele i Terminarz – siatkówka</title>
<style>
  :root{
    --pzps-blue:#0d3b66; --pzps-gold:#c9a227; --row-alt:#f7f8fa;
    --text:#1c1c1c; --muted:#6b7280; --win:#e7f6ec; --loss:#fdecec;
  }
  body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;background:#f2f5f9;color:var(--text);}
  header.site-header{background:var(--pzps-blue);color:#fff;padding:18px 16px;box-shadow:0 2px 8px rgba(0,0,0,.08);}
  .site-header .wrap{max-width:1100px;margin:0 auto;}
  .site-title{margin:0;font-weight:700;font-size:clamp(18px,2.3vw,24px);}
  .container{max-width:1100px;margin:28px auto;padding:0 16px;}
  .card{background:#fff;border:1px solid #e8edf3;border-radius:12px;overflow:hidden;box-shadow:0 6px 18px rgba(13,59,102,.08);margin-bottom:20px;}
  .card-header{background:linear-gradient(180deg,#114676,#0d3b66);color:#fff;padding:14px 16px;border-bottom:3px solid var(--pzps-gold);}
  .card-header h2{margin:0;font-size:clamp(16px,2vw,20px);}
  .card-body{padding:12px 14px;}
  .table-wrap{overflow-x:auto;}
  table.pzps{width:100%;border-collapse:collapse;min-width:560px;}
  table.pzps thead th{background:var(--pzps-blue);color:#fff;padding:10px 8px;text-align:center;}
  table.pzps tbody td{padding:10px 8px;text-align:center;border-bottom:1px solid #eef2f6;}
  table.pzps tbody tr:nth-child(even){background:var(--row-alt);}
  tr.win-row{background:var(--win)!important;}
  tr.loss-row{background:var(--loss)!important;}
  .chip{display:inline-block;padding:4px 8px;border-radius:999px;font-size:12px;border:1px solid transparent;}
  .chip-cat{background:#f9fafb;color:#334155;border-color:#e5e7eb;}
</style>
</head>
<body>
<header class="site-header"><div class="wrap"><h1 class="site-title">Tabele i terminarz – siatkówka młodzieżowa</h1></div></header>

<main class="container">
  <section class="card">
    <div class="card-header"><h2>MŁODZIK</h2></div>
    <div class="card-body">
      <div class="table-wrap">
        <table class="pzps" id="tbl-mlodzik">
          <thead><tr><th>Drużyna</th><th>M</th><th>W</th><th>P</th><th>Małe pkt</th><th>Punkty</th></tr></thead>
          <tbody></tbody>
        </table>
      </div>
      <div class="note" style="color:var(--muted);font-size:13px;margin-top:8px;">3:0/3:1 → 3 pkt; 3:2 → 2 pkt (zwycięzca) i 1 pkt (pokonany). Przy równej liczbie punktów decydują małe punkty.</div>
    </div>
  </section>

  <section class="card">
    <div class="card-header"><h2>MŁODZICZKA</h2></div>
    <div class="card-body">
      <div class="table-wrap">
        <table class="pzps" id="tbl-mlodziczka">
          <thead><tr><th>Drużyna</th><th>M</th><th>W</th><th>P</th><th>Małe pkt</th><th>Punkty</th></tr></thead>
          <tbody></tbody>
        </table>
      </div>
    </div>
  </section>

  <section class="card">
    <div class="card-header"><h2>TERMINARZ</h2></div>
    <div class="card-body">
      <div class="table-wrap">
        <table class="pzps" id="tbl-terminarz">
          <thead><tr><th>Data</th><th>Gospodarz</th><th>Gość</th><th>Wynik</th><th>Sety</th><th>Kategoria</th></tr></thead>
          <tbody></tbody>
        </table>
      </div>
      <div class="note" style="color:var(--muted);font-size:13px;margin-top:8px;">Nadrobiące mecze na górze; rozegrane oznaczone kolorem wiersza.</div>
    </div>
  </section>
</main>

<script>
  // TWÓJ link /exec z wdrożenia Web App:
  const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbyXpZ5n1lVl6wCGdo0UU1WWBmE2oPgCLeUSfoCFv85OvrJpMTzUT7nZq9cRMa0algoh/exec";

  function fmtDate(d){
    const dt = new Date(d);
    if (!isNaN(dt)) return dt.toLocaleDateString('pl-PL');
    return d ?? '';
  }
  function td(text, left=false){
    const cell = document.createElement('td');
    if (left) cell.style.textAlign='left';
    cell.textContent = text ?? '';
    return cell;
  }

  function onData(data){
    // ===== Tabele =====
    const tbM = document.querySelector('#tbl-mlodzik tbody');
    tbM.innerHTML = '';
    (data.tabela_mlodzik || []).forEach(r=>{
      const tr=document.createElement('tr');
      tr.appendChild(td(r.team, true));
      tr.appendChild(td(r.matches));
      tr.appendChild(td(r.wins));
      tr.appendChild(td(r.losses));
      tr.appendChild(td(r.smallPoints));
      tr.appendChild(td(r.scoreTable));
      tbM.appendChild(tr);
    });

    const tbF = document.querySelector('#tbl-mlodziczka tbody');
    tbF.innerHTML = '';
    (data.tabela_mlodziczka || []).forEach(r=>{
      const tr=document.createElement('tr');
      tr.appendChild(td(r.team, true));
      tr.appendChild(td(r.matches));
      tr.appendChild(td(r.wins));
      tr.appendChild(td(r.losses));
      tr.appendChild(td(r.smallPoints));
      tr.appendChild(td(r.scoreTable));
      tbF.appendChild(tr);
    });

    // ===== Terminarz =====
    const tbT = document.querySelector('#tbl-terminarz tbody');
    tbT.innerHTML = '';

    // sort: nadchodzące (bez wyniku) najpierw, w środku rosnąco po dacie; potem rozegrane
    const list = (data.terminarz || []).slice().sort((a,b)=>{
      const hasA = !!(a && a[3]); const hasB = !!(b && b[3]);
      if (hasA !== hasB) return hasA - hasB;
      const dA = new Date(a && a[0]); const dB = new Date(b && b[0]);
      return (dA?.getTime()||0) - (dB?.getTime()||0);
    });

    list.forEach(row=>{
      const [date, home, away, score, sets, cat] = row;
      const tr = document.createElement('tr');
      if (score && score.includes(':')){
        const [h,a] = score.split(':').map(Number);
        if (!isNaN(h) && !isNaN(a)){
          if (h>a) tr.classList.add('win-row');
          else if (h<a) tr.classList.add('loss-row');
        }
      }
      tr.appendChild(td(fmtDate(date)));
      tr.appendChild(td(home));
      tr.appendChild(td(away));
      tr.appendChild(td(score || ''));
      tr.appendChild(td(sets || ''));
      const catTd = td('', false); 
      const badge = document.createElement('span'); badge.className='chip chip-cat'; badge.textContent = cat || '';
      catTd.appendChild(badge); tr.appendChild(catTd);
      tbT.appendChild(tr);
    });
  }

  // Ładowanie JSONP – wstrzyknięcie <script src="...&callback=onData">
  (function(){
    const s = document.createElement('script');
    s.src = WEB_APP_URL + '?action=get&callback=onData';
    document.body.appendChild(s);
  })();
</script>
</body>
</html>
