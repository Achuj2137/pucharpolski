<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8">
<title>Terminarz i Tabela</title>
<link rel="stylesheet" href="style.css">
<style>
#loginPanel { margin-bottom: 20px; padding: 10px; border: 1px solid #ccc; width: 300px; }
#loginPanel input { margin-right: 5px; }
#loginStatus { font-weight: bold; margin-top: 5px; }
.hidden { display: none; }
</style>
</head>
<body>

<h1>Terminarz i Tabela</h1>

<!-- PANEL LOGOWANIA -->
<div id="loginPanel">
    <h3>Logowanie admina</h3>
    <input type="password" id="adminPass" placeholder="Hasło">
    <button id="loginBtn">Zaloguj</button>
    <div id="loginStatus"></div>
</div>

<section>
    <h2>Tabela — Młodzik</h2>
    <table id="tabela-mlodzik">
        <thead>
            <tr>
                <th>Drużyna</th><th>M</th><th>W</th><th>P</th><th>Pkt</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>
</section>

<section>
    <h2>Tabela — Młodziczka</h2>
    <table id="tabela-mlodziczka">
        <thead>
            <tr>
                <th>Drużyna</th><th>M</th><th>W</th><th>P</th><th>Pkt</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>
</section>

<!-- FORMULARZ TYLKO DLA ZALOGOWANYCH -->
<section id="addMatchSection" class="hidden">
    <h2>Dodaj mecz</h2>
    <form id="meczForm">
        <label>Data: <input type="date" name="data" required></label>
        <label>Gospodarz: <input type="text" name="gospodarz" required></label>
        <label>Gość: <input type="text" name="gosc" required></label>
        <label>Wynik: <input type="text" name="wynik" placeholder="np. 3:2" required></label>
        <label>Protokół: <input type="file" name="plik" accept="image/*"></label>
        <button type="submit">Zapisz mecz</button>
    </form>
</section>

<section>
    <h2>Terminarz</h2>
    <table id="terminarz">
        <thead>
            <tr>
                <th>Data</th><th>Gospodarz</th><th>Gość</th><th>Wynik</th><th>Protokół</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>
</section>

<script>
const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbyl106GXSzKOMWjI7cJ46mbzv-7Q-nMKPv0VZKBYrL_-V9PcV6jFqqwGL-jLx_7-1TE/exec"; // <- Wstaw swój link /exec
let isLoggedIn = false;
let adminPassword = "";

// Ładowanie danych
async function ladujDane() {
    let res = await fetch(WEB_APP_URL + "?action=get");
    let data = await res.json();

    const t1 = document.querySelector("#tabela-mlodzik tbody");
    t1.innerHTML = "";
    data.tabela_mlodzik.forEach(row => {
        t1.innerHTML += `<tr><td>${row[0]}</td><td>${row[1]}</td><td>${row[2]}</td><td>${row[3]}</td><td>${row[4]}</td></tr>`;
    });

    const t2 = document.querySelector("#tabela-mlodziczka tbody");
    t2.innerHTML = "";
    data.tabela_mlodziczka.forEach(row => {
        t2.innerHTML += `<tr><td>${row[0]}</td><td>${row[1]}</td><td>${row[2]}</td><td>${row[3]}</td><td>${row[4]}</td></tr>`;
    });

    const t3 = document.querySelector("#terminarz tbody");
    t3.innerHTML = "";
    data.terminarz.forEach(row => {
        let protokol = row[4] ? `<a href="${row[4]}" target="_blank">Zobacz</a>` : "";
        t3.innerHTML += `<tr><td>${row[0]}</td><td>${row[1]}</td><td>${row[2]}</td><td>${row[3]}</td><td>${protokol}</td></tr>`;
    });
}

// Obsługa logowania
document.getElementById("loginBtn").addEventListener("click", async () => {
    const pass = document.getElementById("adminPass").value.trim();
    if(!pass) return alert("Podaj hasło");

    let res = await fetch(WEB_APP_URL, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ action: "auth", password: pass })
    });

    let out = await res.json();
    if(out.ok){
        isLoggedIn = true;
        adminPassword = pass;
        document.getElementById("addMatchSection").classList.remove("hidden");
        document.getElementById("loginStatus").textContent = "✅ Zalogowano";
    } else {
        document.getElementById("loginStatus").textContent = "❌ Błędne hasło";
    }
});

// Obsługa formularza dodawania meczu
document.getElementById("meczForm").addEventListener("submit", async (e) => {
    e.preventDefault();
    if(!isLoggedIn) return alert("Musisz być zalogowany");

    let formData = new FormData(e.target);
    formData.append("action", "addMatch");
    formData.append("password", adminPassword);

    let res = await fetch(WEB_APP_URL, { method: "POST", body: formData });
    let out = await res.text();
    alert(out);
    ladujDane();
});

ladujDane();
</script>

</body>
</html>
