<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8">
<title>Terminarz i Tabela</title>
<style>
  body {
    font-family: Arial, sans-serif;
    color: white;
    text-align: center;
    background: url('https://upload.wikimedia.org/wikipedia/commons/7/77/Volleyball_court_illustration.png') no-repeat center center fixed;
    background-size: cover;
    margin: 0;
    padding: 0;
  }
  h1 {
    background: rgba(0,0,0,0.7);
    padding: 15px;
    margin: 0;
  }
  .section {
    margin: 20px auto;
    padding: 15px;
    max-width: 95%;
    background: rgba(0,0,0,0.6);
    border-radius: 10px;
    overflow-x: auto;
  }
  table {
    width: 100%;
    border-collapse: collapse;
    margin: 10px 0;
    min-width: 500px;
  }
  table, th, td {
    border: 1px solid white;
  }
  th, td {
    padding: 8px;
    text-align: center;
    white-space: nowrap;
  }
  th {
    background: rgba(255,255,255,0.2);
  }
  /* Kolorowanie terminarza */
  .win { background-color: rgba(0, 128, 0, 0.4); }
  .loss { background-color: rgba(255, 0, 0, 0.4); }
  .pending { background-color: rgba(128, 128, 128, 0.4); }

  @media (max-width: 768px) {
    h1 {
      font-size: 20px;
    }
    th, td {
      font-size: 14px;
      padding: 6px;
    }
  }
</style>
</head>
<body>

<h1>Terminarz i Tabele Ligowe</h1>

<div class="section">
  <h2>Tabela — Młodzik</h2>
  <table id="tabela-mlodzik">
    <thead>
      <tr>
        <th>Drużyna</th>
        <th>M</th>
        <th>W</th>
        <th>P</th>
        <th>Małe punkty</th>
        <th>Punkty</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
</div>

<div class="section">
  <h2>Tabela — Młodziczka</h2>
  <table id="tabela-mlodziczka">
    <thead>
      <tr>
        <th>Drużyna</th>
        <th>M</th>
        <th>W</th>
        <th>P</th>
        <th>Małe punkty</th>
        <th>Punkty</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
</div>

<div class="section">
  <h2>Terminarz</h2>
  <table id="terminarz">
    <thead>
      <tr>
        <th>Data</th>
        <th>Gospodarz</th>
        <th>Gość</th>
        <th>Wynik</th>
        <th>Sety</th>
        <th>Kategoria</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
</div>

<script>
const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbx9Vq-obHD0tFX2e9e0bzYqBwFO9LdGShK9j5-6M7wDvwwFEfE65X7VHTEDR66xAT6jowEi9V/exec";

async function ladujDane() {
  let res = await fetch(WEB_APP_URL + "?action=get");
  let data = await res.json();

  // Tabela Młodzik
  const t1 = document.querySelector("#tabela-mlodzik tbody");
  t1.innerHTML = "";
  data.tabela_mlodzik.forEach(row => {
    t1.innerHTML += `<tr>
      <td>${row.team}</td>
      <td>${row.matches}</td>
      <td>${row.wins}</td>
      <td>${row.losses}</td>
      <td>${row.smallPoints}</td>
      <td>${row.scoreTable}</td>
    </tr>`;
  });

  // Tabela Młodziczka
  const t2 = document.querySelector("#tabela-mlodziczka tbody");
  t2.innerHTML = "";
  data.tabela_mlodziczka.forEach(row => {
    t2.innerHTML += `<tr>
      <td>${row.team}</td>
      <td>${row.matches}</td>
      <td>${row.wins}</td>
      <td>${row.losses}</td>
      <td>${row.smallPoints}</td>
      <td>${row.scoreTable}</td>
    </tr>`;
  });

  // Terminarz z sortowaniem
  const t3 = document.querySelector("#terminarz tbody");
  t3.innerHTML = "";

  let terminarzSorted = [...data.terminarz].sort((a, b) => {
    let wynikA = a[3] ? 1 : 0;
    let wynikB = b[3] ? 1 : 0;
    if (wynikA !== wynikB) return wynikA - wynikB; // Najpierw bez wyniku
    let [dA, mA, rA] = a[0].split(".").map(Number);
    let [dB, mB, rB] = b[0].split(".").map(Number);
    return new Date(rA, mA - 1, dA) - new Date(rB, mB - 1, dB);
  });

  terminarzSorted.forEach(row => {
    let wynik = row[3];
    let cssClass = "pending";
    if (wynik && wynik.includes(":")) {
      let [gosp, gosc] = wynik.split(":").map(Number);
      if (gosp > gosc) cssClass = "win";
      else if (gosp < gosc) cssClass = "loss";
    }
    t3.innerHTML += `<tr class="${cssClass}">
      <td>${row[0]}</td>
      <td>${row[1]}</td>
      <td>${row[2]}</td>
      <td>${row[3] || ""}</td>
      <td>${row[4] || ""}</td>
      <td>${row[5]}</td>
    </tr>`;
  });
}

ladujDane();
</script>

</body>
</html>
