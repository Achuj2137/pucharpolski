<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8">
<title>Terminarz i Tabela</title>
<link rel="stylesheet" href="style.css">
</head>
<body>

<h1>Terminarz i Tabela</h1>

<section>
    <h2>Tabela — Młodzik</h2>
    <table id="tabela-mlodzik">
        <thead>
            <tr>
                <th>Drużyna</th>
                <th>M</th>
                <th>W</th>
                <th>P</th>
                <th>Pkt</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>
</section>

<section>
    <h2>Tabela — Młodziczka</h2>
    <table id="tabela-mlodziczka">
        <thead>
            <tr>
                <th>Drużyna</th>
                <th>M</th>
                <th>W</th>
                <th>P</th>
                <th>Pkt</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>
</section>

<section>
    <h2>Dodaj mecz</h2>
    <form id="meczForm">
        <label>Data: <input type="date" name="data" required></label>
        <label>Gospodarz: <input type="text" name="gospodarz" required></label>
        <label>Gość: <input type="text" name="gosc" required></label>
        <label>Wynik: <input type="text" name="wynik" placeholder="np. 3:2" required></label>
        <label>Protokół: <input type="file" name="plik" accept="image/*"></label>
        <button type="submit">Zapisz mecz</button>
    </form>
</section>

<section>
    <h2>Terminarz</h2>
    <table id="terminarz">
        <thead>
            <tr>
                <th>Data</th>
                <th>Gospodarz</th>
                <th>Gość</th>
                <th>Wynik</th>
                <th>Protokół</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>
</section>

<script>
const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbz7xfcQp9MxPOXFbFZy8NuIFG6iZvl4Pw3SxNiC8Y73PG1qGQ3YOcwIc1JEpp8M9UTh/exec";

async function ladujDane() {
    let res = await fetch(WEB_APP_URL + "?action=getData");
    let data = await res.json();

    // Tabele
    const t1 = document.querySelector("#tabela-mlodzik tbody");
    t1.innerHTML = "";
    data.tabela_mlodzik.forEach(row => {
        t1.innerHTML += `<tr><td>${row[0]}</td><td>${row[1]}</td><td>${row[2]}</td><td>${row[3]}</td><td>${row[4]}</td></tr>`;
    });

    const t2 = document.querySelector("#tabela-mlodziczka tbody");
    t2.innerHTML = "";
    data.tabela_mlodziczka.forEach(row => {
        t2.innerHTML += `<tr><td>${row[0]}</td><td>${row[1]}</td><td>${row[2]}</td><td>${row[3]}</td><td>${row[4]}</td></tr>`;
    });

    // Terminarz
    const t3 = document.querySelector("#terminarz tbody");
    t3.innerHTML = "";
    data.terminarz.forEach(row => {
        let protokol = row[4] ? `<a href="${row[4]}" target="_blank">Zobacz</a>` : "";
        t3.innerHTML += `<tr><td>${row[0]}</td><td>${row[1]}</td><td>${row[2]}</td><td>${row[3]}</td><td>${protokol}</td></tr>`;
    });
}

document.getElementById("meczForm").addEventListener("submit", async (e) => {
    e.preventDefault();
    let formData = new FormData(e.target);
    formData.append("action", "addMatch");

    let res = await fetch(WEB_APP_URL, { method: "POST", body: formData });
    let out = await res.text();
    alert(out);
    ladujDane();
});

ladujDane();
</script>

</body>
</html>
