<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Tabele i terminarz – siatkówka</title>
<style>
  :root{
    --pzps-blue:#0d3b66;
    --pzps-gold:#c9a227;
    --row-alt:#f7f8fa;
    --text:#1c1c1c;
    --muted:#6b7280;
    --win:#e7f6ec;
    --loss:#fdecec;
  }
  body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;color:var(--text);background:#f2f5f9;}
  header.site-header{background:var(--pzps-blue);color:#fff;padding:18px 16px;box-shadow:0 2px 8px rgba(0,0,0,.08);}
  .site-header .wrap{max-width:1100px;margin:0 auto;}
  .site-title{margin:0;font-weight:700;font-size:clamp(18px,2.3vw,24px);}
  .container{max-width:1100px;margin:28px auto;padding:0 16px;}
  .card{background:#fff;border-radius:12px;overflow:hidden;box-shadow:0 6px 18px rgba(13,59,102,.08);margin-bottom:20px;border:1px solid #e8edf3;}
  .card-header{background:linear-gradient(180deg, #114676 0%, #0d3b66 100%);color:#fff;padding:14px 16px;border-bottom:3px solid var(--pzps-gold);}
  .card-header h2{margin:0;font-size:clamp(16px,2vw,20px);}
  .card-body{padding:12px 14px;}
  .table-wrap{overflow-x:auto;}
  table.pzps{width:100%;border-collapse:collapse;min-width:560px;}
  table.pzps thead th{text-align:center;font-weight:700;color:#fff;background:var(--pzps-blue);padding:10px 8px;}
  table.pzps tbody td{padding:10px 8px;text-align:center;border-bottom:1px solid #eef2f6;}
  table.pzps tbody tr:nth-child(even){background:var(--row-alt);}
  .chip{display:inline-block;padding:4px 8px;border-radius:999px;font-size:12px;border:1px solid transparent;}
  .chip-cat{background:#f9fafb;color:#334155;border-color:#e5e7eb;}
</style>
</head>
<body>
<header class="site-header">
  <div class="wrap">
    <h1 class="site-title">Tabele, terminarze i rankingi – siatkówka młodzieżowa</h1>
  </div>
</header>
<main class="container">

  <!-- Ranking Młodzik -->
  <section class="card">
    <div class="card-header"><h2>Ranking – Młodzik</h2></div>
    <div class="card-body">
      <div class="table-wrap">
        <table class="pzps" id="tbl-ranking-mlodzik">
          <thead><tr><th>Drużyna</th><th>Punkty</th></tr></thead>
          <tbody></tbody>
        </table>
      </div>
    </div>
  </section>

  <!-- Ranking Młodziczka -->
  <section class="card">
    <div class="card-header"><h2>Ranking – Młodziczka</h2></div>
    <div class="card-body">
      <div class="table-wrap">
        <table class="pzps" id="tbl-ranking-mlodziczka">
          <thead><tr><th>Drużyna</th><th>Punkty</th></tr></thead>
          <tbody></tbody>
        </table>
      </div>
    </div>
  </section>

  <!-- Terminarz Młodzik -->
  <section class="card">
    <div class="card-header"><h2>Terminarz – Młodzik</h2></div>
    <div class="card-body">
      <div class="table-wrap">
        <table class="pzps" id="tbl-terminarz-mlodzik">
          <thead><tr><th>Data</th><th>Gospodarz</th><th>Gość</th><th>Wynik</th><th>Sety</th><th>Grupa</th><th>Protokół</th></tr></thead>
          <tbody></tbody>
        </table>
      </div>
    </div>
  </section>

  <!-- Terminarz Młodziczka -->
  <section class="card">
    <div class="card-header"><h2>Terminarz – Młodziczka</h2></div>
    <div class="card-body">
      <div class="table-wrap">
        <table class="pzps" id="tbl-terminarz-mlodziczka">
          <thead><tr><th>Data</th><th>Gospodarz</th><th>Gość</th><th>Wynik</th><th>Sety</th><th>Grupa</th><th>Protokół</th></tr></thead>
          <tbody></tbody>
        </table>
      </div>
    </div>
  </section>

</main>

<script>
const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbw_qZZONOjmKCvve27HuOJSm7waQcbXro0fKg1PX0E5Yg_dL0nkldZCKScyUo4WqUcK/exec?action=get";

function createCell(text, opts={}) {
  const td = document.createElement('td');
  if (opts.left) td.style.textAlign = 'left';
  td.textContent = text ?? '';
  return td;
}
function createLinkCell(value) {
  const td = document.createElement('td');
  const v = (value || '').toString().trim();
  if (isUrl(v)) {
    const a = document.createElement('a');
    a.href = v; a.target = "_blank"; a.rel = "noopener";
    a.textContent = "📄 protokół";
    td.appendChild(a);
  } else {
    td.textContent = '—';
  }
  return td;
}
function isUrl(v){
  try{ const u = new URL(v); return /^https?:$/.test(u.protocol); }catch(e){ return false; }
}
function formatDate(d) {
  const dt = new Date(d);
  return !isNaN(dt) ? dt.toLocaleDateString('pl-PL') : (d || '');
}

// Render jednej tabeli z filtrowaniem po kolumnie „Grupa”
function renderTerminarz(tbodySelector, rows, grupaWanted){
  const tb = document.querySelector(tbodySelector);
  tb.innerHTML = '';
  rows
    .filter(r => r && (r[1] || r[2]))              // ma gospodarza/gościa
    .filter(r => (r[5] || '').trim() === grupaWanted) // kol. 5 = Grupa
    .sort((a,b)=> new Date(a[0]).getTime()-new Date(b[0]).getTime())
    .forEach(row=>{
      // [Data, Gospodarz, Gość, Wynik, Sety, Grupa, Protokół]
      const [date, home, away, score, sets, grupa, protokol] = row;
      const tr = document.createElement('tr');
      tr.appendChild(createCell(formatDate(date)));
      tr.appendChild(createCell(home, {left:true}));
      tr.appendChild(createCell(away, {left:true}));
      tr.appendChild(createCell(score || ''));
      tr.appendChild(createCell(sets || '', {left:true}));
      tr.appendChild(createCell(grupa || ''));
      tr.appendChild(createLinkCell(protokol));
      tb.appendChild(tr);
    });
}

async function loadData(){
  const res = await fetch(WEB_APP_URL, { cache:'no-store' });
  const data = await res.json();

  // Sklej wszystkie fazy w jedną listę dla każdej kategorii
  const allM = []
    .concat(data.m_elim || [], data.m_liga || [], data.m_final || []);
  const allF = []
    .concat(data.f_elim || [], data.f_liga || [], data.f_final || []);

  // Render
  renderTerminarz('#tbl-terminarz-mlodzik tbody', allM, 'Mlodzik');
  renderTerminarz('#tbl-terminarz-mlodziczka tbody', allF, 'Mlodziczka');

  // Rankingi (jeśli masz sekcje rankingowe)
  const tbRM = document.querySelector('#tbl-ranking-mlodzik tbody');
  if (tbRM){
    tbRM.innerHTML = '';
    (data.ranking_mlodzik || []).forEach(r=>{
      const tr = document.createElement('tr');
      tr.appendChild(createCell(r.team, {left:true}));
      tr.appendChild(createCell(r.points));
      tbRM.appendChild(tr);
    });
  }
  const tbRF = document.querySelector('#tbl-ranking-mlodziczka tbody');
  if (tbRF){
    tbRF.innerHTML = '';
    (data.ranking_mlodziczka || []).forEach(r=>{
      const tr = document.createElement('tr');
      tr.appendChild(createCell(r.team, {left:true}));
      tr.appendChild(createCell(r.points));
      tbRF.appendChild(tr);
    });
  }
}

loadData();
</script>

</body>
</html>
